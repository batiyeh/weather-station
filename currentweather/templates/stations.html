{% extends 'base.html' %}

{% block content %}
{% csrf_token %}
<div class="container" style="margin-top: 30px;">
    <h1>Connected Stations</h1>
    <table id="station-table" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Temperature</th>
                <th>Pressure</th>
                <th>Humidity</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

{% block script %}
<script type="text/javascript">
    $(document).ready(function(){
        updateSensorData();
    });

    setInterval(updateSensorData, 5000);
    //called function updatestation every 5000 miliseconds (5 seconds)
    function updateSensorData(){
    //retrieves data from views.randomPage and will update html page without refresh
        $.ajax({
            type:'POST',
            url: '',
            dataType: 'json',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
            success: function(data){
                $("#station-table tbody tr").remove();
                for(var i = 0; i < data.stations.length; i++){
                    var row = data.stations[i];
                    $('#station-table tbody').append("<tr><td>" + row['wid'] + "</td><td>" + row['temperature'] + " &#176;F" + "</td><td>" + row['pressure'] + " hPa" + "</td><td>" + row['humidity'] + " %" + "</td></tr>");
                }
                //updates 'station-table' with station rows
                //this will essentially refresh every single piece of data on the screen
                //regardless of if it was changed or not
            },
            failure: function(data){
                console.log(data);
            },
        });
    };
</script>
{% endblock script %}

{% endblock %}